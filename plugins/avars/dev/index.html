<!DOCTYPE html>
<!--
Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
-->
<html>
<head>
    <meta charset="utf-8">
    <title>Placeholder Plugin &mdash; CKEditor Sample</title>
    <script src="../../../ckeditor.js"></script>
    <script src="../../../dev/console/console.js"></script>
    <script src="../../../dev/console/focusconsole.js"></script>
    <script src="../../widget/dev/console.js"></script>
    <link rel="stylesheet" href="../../../samples/old/sample.css">
</head>
<body>
<h1 class="samples">Avars Plugin</h1>

<h2>Classic (iframe-based) Sample</h2>
<textarea cols="80" id="editor1" name="editor1" rows="10">
    <p><a href="[[test DD]]">  sd [[test AA]] sd </a></p>

    &lt;p&gt;This is a [[test AA]]. You are using &lt;a href="https://ckeditor.com/"&gt;CKEditor&lt;/a&gt;. &lt;/p&gt;
	</textarea>

<h2>Inline Sample</h2>
<div id="editor2" contenteditable="true" cols="10" rows="10">
    <p>This is a [[test AA]]. You are using <a href="https://ckeditor.com/">CKEditor</a>. </p>
</div>

<h2>Div Editing Area Sample</h2>
<textarea cols="80" id="editor3" name="editor3" rows="10">
		&lt;p&gt;This is a [[test AA]]. You are using &lt;a href="https://ckeditor.com/"&gt;CKEditor&lt;/a&gt;. &lt;/p&gt;
	</textarea>

<ul id="avarsList">
    <li>
        <div class="avars" data-avar="test AA" draggable="true" tabindex="0">
            <!--<img src="https://sdk.ckeditor.com/samples/assets/draganddrop/img/hfin.png" />-->
            TEST
        </div>
    </li>
    <li>
        <div class="avars" data-avar="test CC" draggable="true" tabindex="0">
            <!--<img src="https://sdk.ckeditor.com/samples/assets/draganddrop/img/hfin.png" />-->
            TEST
        </div>
    </li>
</ul>

<script>


    var A = [
        {code : 'test AA', text : 'test aAaA'},
        {code : 'test BB', text : 'test bBbB', required : true},
        {code : 'test CC', text : 'test cCcC', type : 'url', label : 'CCC'},
        {code : 'test DD', text : 'test dDdD', type : 'url', required : true, label : '[[test AA]]'}

    ];

    var dom = document.getElementById('avarsList');
    A.forEach(function (el) {
        var child = document.createElement('li');
        var div = document.createElement('div');
        div.dataset['avar'] = el.code;
        div.dataset['avarFull'] = el;
        div.dataset['avarUrl'] = (el.type ==='url'?'yes':'no');
        div.dataset['avarLabel'] = (el.type ==='url'?el.label:el.text);

        div.setAttribute('draggable', true);
        div.classList.add('avars');
        div.innerText = 'X ' + el.text;
        child.appendChild(div);
        dom.appendChild(child);
    });

    var e = CKEDITOR.replace('editor1', {
        extraPlugins : 'avars',
        height       : 100,
        avars        : A
    });
    e.on('instanceReady', function () {
        e.validAvar().then(function (msg) {
            console.log('msg', msg);
        });
        e.on('change', function () {
            e.validAvar().then(function (msg) {
                console.log('msg', msg);
            });
        })
    });


    CKEDITOR.inline('editor2', {
        extraPlugins : 'avars',
        height       : 100,
        avars        : A
    });

    CKEDITOR.replace('editor3', {
        extraPlugins : 'avars,divarea',
        height       : 100,
        avars        : A
    });


    /*CKCONSOLE.create('widget', {editor : 'editor1'});
    CKCONSOLE.create('focus', {editor : 'editor1'});
    CKCONSOLE.create( 'widget', { editor: 'editor2' } );
    CKCONSOLE.create( 'focus', { editor: 'editor2' } );
    CKCONSOLE.create( 'widget', { editor: 'editor3' } );
    CKCONSOLE.create( 'focus', { editor: 'editor3' } );*/


    //https://sdk.ckeditor.com/samples/draganddrop.html#
    CKEDITOR.on('instanceReady', function () {
        CKEDITOR.document.getById('avarsList').on('dragstart', function (evt) {
            var target = evt.data.getTarget().getAscendant('div', true);
            CKEDITOR.plugins.clipboard.initDragDataTransfer(evt);
            var dataTransfer = evt.data.dataTransfer;
            //dataTransfer.setData('avar', A[target.data('avarId')]);

            if (target.data('avar-url')==='yes') {
                //dataTransfer.setData('avar', target.data('avar'));
                var html = '<a href="[[' + target.data('avar') + ']]">' + target.data('avar-label')+ '</a>';
                console.log('html',html);
                dataTransfer.setData('text/html', html);
            } else {
                dataTransfer.setData('avar', target.data('avar'));
                dataTransfer.setData('text/html', target.getText());
            }
            /*if ( dataTransfer.$.setDragImage ) {
                dataTransfer.$.setDragImage( target.findOne( 'img' ).$, 0, 0 );
            }*/
        })
    })
</script>
</body>
</html>


// nice : url -> cmslink: https://github.com/die-antwort/ckeditor/commit/92c81c7eb1ce65584e8bf9c3b8571358d26d17fe
